---
title: "homework06"
author: "Your Name"
date: "2024-03-09"
output: pdf_document
---



```{r}
library(tidyverse)
library(nycflights13)
#install.packages("maps")
library(maps)
```


All of the problems in this problem set use the `nycflights13` data:

This package provides the following data tables.

* `?flights`: all flights that departed from NYC in 2013
* `?weather`: hourly meterological data for each airport
* `?planes`: construction information about each plane
* `?airports`: airport names and locations
* `?airlines`: translation between two letter carrier codes and names


## Problem 1: Number of Flights for each Destination (4 points)

(a) Compute the number of flights for each destination in the continental U.S. and save it to a table called `n_flights_per_dest`. This table should contain 4 columns: `dest`, `lat`, `lon` and `n` (one row for each destination). How many rows does this table contain?

Then, visualize this table on a map, as shown below. ***(2 points)***


![Image for Problem1](Number of Flights for each Dest.png)


```{r}

```


**SOLUTION**
```{r}
n_flights_per_dest <- flights %>%
  inner_join(airports, by = c("dest" = "faa")) %>%
  filter(lon > -130) %>%
  group_by(dest) %>%
  mutate(n = n()) %>%
  select(dest, lat, lon, n) %>%
  distinct()

n_flights_per_dest %>% nrow()

ggplot(n_flights_per_dest, aes(lon, lat)) +
  borders("state") +
  geom_point(aes(color = n)) +
  coord_quickmap() +
  ggtitle('Number of flights for each destination in continental U.S.') + 
  theme_bw()
```

(b) Let's focus on only John F. Kennedy International Airport (JFK) . Join the `weather` and `flights` tables by `year`, `month`, `day`, and `origin`, keeping only rows shared both. Name the new table `jfk_weather_combined`. Use `jfk_weather_combined` to plot the relationship between daily average wind speed and daily average departure delay at JFK.

Explain the relationship you notice. ***(2 points)***


**SOLUTION**
```{r}
jfk_weather_delays <- flights %>%
  filter(origin == "JFK") %>%
  inner_join(weather, by = c("year", "month", "day", "origin"))

daily_averages <- jfk_weather_delays %>%
  group_by(year, month, day) %>%
  summarize(avg_wind_speed = mean(wind_speed, na.rm = TRUE),
            avg_dep_delay = mean(dep_delay, na.rm = TRUE)) %>%
  ungroup()

ggplot(daily_averages, aes(x = avg_wind_speed, y = avg_dep_delay)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", color = "blue", se = FALSE) +
  labs(title = "Relationship Between Wind Speed and Departure Delay at JFK",
       x = "Average Wind Speed (knots)",
       y = "Average Departure Delay (minutes)") +
  theme_bw()
```
As the daily average wind speed increase, the daily average departure delay time also increase a little.


## Problem 2: Exploratory Data Analysis on the `Flights` Data (6 points)

For this question, there can be multiple correct answers.


**(a)** Focus on the following airlines: American, Delta, JetBlue, US Airways and United, and consider only non-cancelled flights (i.e., `arr_delay` is not `NA`). For a given flight, its capacity is defined as the number of seats in the aircraft used for that flight. To make things simple, whenever a flight's capacity is unknown, we set it to 50.

Your friend, Haerin, comes to you with a curious question: "For each airline, do you know whether its total capacity in 2013 roughly uniformly distributed across all 12 months?"

As a STATS 306 student, please help Haerin by producing an appropriate plot. Make sure to use appropriate titles and axis labels. Explain why the plot you produced is appropriate. ***(2 points)***

**SOLUTION**

```{r}
flights %>%
  filter(!is.na(arr_delay)) %>%
  filter(carrier %in% c('AA', 'DL', 'B6', 'US', 'UA')) %>%
  left_join(select(planes, tailnum, seats),
    by = c("tailnum")) %>%
  mutate(seats = coalesce(seats, 50)) %>%
  group_by(month, carrier) %>%
  summarize(cap_month = sum(seats)) %>%
  group_by(carrier) %>%
  mutate(cap_carrier = sum(cap_month),
        prop_month = cap_month / cap_carrier) %>%
  mutate(month = factor(month.abb[month], levels = month.abb)) %>%
  ggplot(aes(x = month, y = prop_month, group = carrier)) +
  geom_line(aes(color = carrier)) +
  xlab('Month') +
  ylab('Proportion of capacity') +
  ggtitle('Monthly proportion of capacity per airline')
```


**(b)** Haerin is impressed with your data wrangling and visualization skills. Wasting no time, she comes up with another question:

"According to Wikipedia, there are more Boeing 737 as compared to Airbus A320 and its variants (Airbus A318, A319 and A321). If I were to guess, this means that there are more Boeing 737 flights than Airbus A318, A319, A320 and A321 flights combined for each origin airport. Could you check whether my guess is correct?"

Produce a plot which answers Haerin's question. Make sure to use appropriate titles and axis labels. Explain how the plot you produced can answer Haerin's question. ***(2 points)***

```{r}

```



**SOLUTION**
```{r}
flights %>%
  inner_join(select(planes, tailnum, model)) %>%
  group_by(origin) %>%
  summarize(`Boeing 737` = sum(str_sub(model, 1, 3) == "737"),
            `Airbus A320 and its variants` = sum(str_sub(model, 1, 4) %in% c("A318", "A319", "A320", "A321"))) %>%
  pivot_longer(cols = !origin, names_to = "Aircraft", values_to = "Count") %>%
  ggplot(aes(x = origin, y = Count, fill = Aircraft)) +
  geom_col(position = "fill") +
  xlab('Origin airport') +
  ylab('Proportion') +
  ggtitle('Proportion of Airbus A320 and Boeing 737 \n flights for each origin airport')
```


**(c)** Haerin asks one last question.

"Considering that the three origin airports, JFK, EWR and LGA, are in close proximity to each other, I would imagine that the temperatures in these airports should approximately be the same. Could you please check whether there are times **in January** at which there exist two airports whose temperatures differ by more than 10 degrees? By *time*, I am referring to a (`year`, `month`, `day`, `hour`) tuple."

Produce a table which answers Haerin's question. How many such times (if any) are there? ***(2 points)***

```{r}

```


**SOLUTION**
```{r}
weather %>%
  filter(month == 1) %>%
  select(year, month, day, hour, origin, temp) %>%
  group_by(origin) %>%
  pivot_wider(names_from = 'origin', values_from = 'temp') %>%
  drop_na() %>%
  filter((abs(EWR - JFK) > 10) | (abs(EWR - LGA) > 10) | (abs(JFK - LGA) > 10))
```

